const PlatformSelector = require('./PlatformSelector');

describe('PlatformSelector', () => {
  describe('_getPlatforms', () => {
    it('should return platforms passed to parser', () => {
      const issueBody = ``;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector._getPlatforms()).toStrictEqual(['Android', 'iOS', 'Web']);
    });
  });

  describe('_getPlatformLabels', () => {
    it('should return label platforms passed to parser', () => {
      const issueBody = ``;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector._getPlatformLabels()).toStrictEqual(['ü§ñandroid', 'üçéiOS', 'üß≠web']);
    });
  });

  describe('selectLabelsToAdd', () => {
    it('should return empty array when issue body is empty', () => {
      const issueBody = ``;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector.selectLabelsToAdd()).toStrictEqual([]);
    });

    it('should return empty array when issue body is null', () => {
      const issueBody = null;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector.selectLabelsToAdd()).toStrictEqual([]);
    });

    it('should return empty array when issue body is undefined', () => {
      const issueBody = undefined;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector.selectLabelsToAdd()).toStrictEqual([]);
    });

    it('should return empty array when no platform is selected', () => {
      const issueBody = `
      - [ ] iOS
      - [ ] Android
      - [ ] Web
      `;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector.selectLabelsToAdd()).toStrictEqual([]);
    });

    it('should return correct label when a platform is selected', () => {
      const issueBody = `
      - [x] iOS
      - [ ] Android
      - [ ] Web
      `;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector.selectLabelsToAdd()).toStrictEqual(['üçéiOS']);
    });

    it('should return correct labels when platforms are selected', () => {
      const issueBody = `
      - [x] iOS
      - [x] Android
      - [ ] Web
      `;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector.selectLabelsToAdd()).toEqual(['üçéiOS', 'ü§ñandroid']);
    });

    it('should return correct labels when platforms are selected', () => {
      const issueBody = `
      - [x] iOS
      - [x] Android
      - [x] Web
      `;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector.selectLabelsToAdd()).toEqual(['üçéiOS', 'ü§ñandroid', 'üß≠web']);
    });

    it('should return correct labels when platforms are selected', () => {
      const issueBody = `
      - [ ] iOS
      - [x] Android
      - [x] Web
      `;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector.selectLabelsToAdd()).toEqual(['ü§ñandroid', 'üß≠web']);
    });
    it('should return correct labels when platforms are selected even if whitespace is added in checkboxes', () => {
      const issueBody = `
      - [ ] iOS
      - [x ] Android
      - [ x] Web
      `;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector.selectLabelsToAdd()).toEqual(['ü§ñandroid', 'üß≠web']);
    });

    it('should return correct labels when non standard check is used', () => {
      const issueBody = `
      - [‚úÖ] iOS
      `;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector.selectLabelsToAdd()).toEqual(['üçéiOS']);
    });

    it('should return correct labels when non standard check is used', () => {
      const issueBody = `
      - [ ] Android
      - [ yes] iOS
      - [ ] Web
      `;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector.selectLabelsToAdd()).toEqual(['üçéiOS']);
    });

    it('should return correct labels when some text is added after the platform', () => {
      const issueBody = `
      - [x] Android (I marked but I haven't tested, the problem should persist)
      - [x] iOS
      - [ ] Web      
      `;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector.selectLabelsToAdd()).toEqual(['ü§ñandroid', 'üçéiOS']);
    });

    it('should return correct labels when space is added between x character', () => {
      const issueBody = `
      - [ ] Android
      - [ x ] iOS
      - [ ] Web  
      `;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector.selectLabelsToAdd()).toEqual(['üçéiOS']);
    });

    it('should return correct labels when when some text is added after the platform and capitalized character is used', () => {
      const issueBody = `
      - [ ] Android (not sure)
      - [X] iOS
      - [ ] Web (not sure)
      `;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector.selectLabelsToAdd()).toEqual(['üçéiOS']);
    });

    it('should return correct labels when checkbox is missing a space', () => {
      const issueBody = `
      - [] Android
      - [x] iOS
      - [ ] Web
      `;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector.selectLabelsToAdd()).toEqual(['üçéiOS']);
    });
  });

  describe('selectLabelsToRemove', () => {
    it('should return array with all labels when issue body is empty', () => {
      const issueBody = ``;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector.selectLabelsToRemove()).toEqual(
        expect.arrayContaining(['üçéiOS', 'ü§ñandroid', 'üß≠web'])
      );
    });

    it('should return array with all labels when issue body is null', () => {
      const issueBody = null;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector.selectLabelsToRemove()).toEqual(
        expect.arrayContaining(['üçéiOS', 'ü§ñandroid', 'üß≠web'])
      );
    });

    it('should return array with all labels when issue body is undefined', () => {
      const issueBody = undefined;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector.selectLabelsToRemove()).toEqual(
        expect.arrayContaining(['üçéiOS', 'ü§ñandroid', 'üß≠web'])
      );
    });

    it('should return array with all labels when no platform is selected', () => {
      const issueBody = `
      - [ ] iOS
      - [ ] Android
      - [ ] Web
      `;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector.selectLabelsToRemove()).toEqual(
        expect.arrayContaining(['üçéiOS', 'ü§ñandroid', 'üß≠web'])
      );
    });

    it('should return labels which platforms are not selected', () => {
      const issueBody = `
      - [x] iOS
      - [ ] Android
      - [ ] Web
      `;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector.selectLabelsToRemove()).toEqual(
        expect.arrayContaining(['ü§ñandroid', 'üß≠web'])
      );
    });

    it('should return labels which platforms are not selected', () => {
      const issueBody = `
      - [x] iOS
      - [x] Android
      - [ ] Web
      `;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector.selectLabelsToRemove()).toEqual(['üß≠web']);
    });

    it('should return empty array when all platforms are selected', () => {
      const issueBody = `
      - [x] iOS
      - [x] Android
      - [x] Web
      `;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector.selectLabelsToRemove()).toEqual([]);
    });

    it('should return labels which platforms are not selected', () => {
      const issueBody = `
      - [ ] iOS
      - [x] Android
      - [x] Web
      `;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector.selectLabelsToRemove()).toEqual(['üçéiOS']);
    });
    it('should return labels which platforms are not selected even if whitespace is added in checkboxes', () => {
      const issueBody = `
      - [ ] iOS
      - [x ] Android
      - [ x] Web
      `;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector.selectLabelsToRemove()).toEqual(['üçéiOS']);
    });

    it('should return correct labels when checkbox is missing a space', () => {
      const issueBody = `
      - [] Android
      - [x] iOS
      - [ ] Web
      `;
      const platformSelector = new PlatformSelector(
        issueBody,
        '{"Android": "ü§ñandroid", "iOS": "üçéiOS", "Web": "üß≠web"}'
      );

      expect(platformSelector.selectLabelsToRemove()).toEqual(['ü§ñandroid', 'üß≠web']);
    });
  });
});
